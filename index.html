<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>ðŸ’˜ Operazione San Valentino</title>
  <meta name="theme-color" content="#ff4d6d" />
  <style>
    :root{
      --bg1:#fff0f6; --bg2:#ffe3ec; --card:#ffffffcc; --text:#222;
      --accent:#ff4d6d; --accent2:#ff8fab;
      --shadow: 0 20px 60px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: linear-gradient(180deg, var(--bg1), #fff);
      min-height:100svh;
      overflow-y:auto;
      padding:12px;
      -webkit-tap-highlight-color: transparent;
    }

    .wrap{ width:min(820px, 100%); margin:auto; }
    .card{
      background:var(--card);
      border-radius:26px;
      box-shadow: var(--shadow);
      padding:18px 16px;
      position:relative;
    }

    h1{ font-size:24px; margin:0 0 8px; }
    p{ font-size:14px; margin:0; line-height:1.5 }

    .name{ color:var(--accent); font-weight:900; }

    .photoWrap{
      height:150px;
      border-radius:18px;
      overflow:hidden;
      margin-bottom:12px;
    }
    .photoWrap img{ width:100%; height:100%; object-fit:cover; }

    .btns{ display:flex; flex-direction:column; gap:10px; margin-top:14px; }
    button{
      border:0;
      border-radius:999px;
      padding:12px;
      font-size:15px;
      font-weight:900;
      min-height:44px;
      touch-action:manipulation;
    }
    .primary{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; }
    .ghost{ background:#fff; border:1px solid #ddd; }

    .arena{
      height:52svh;
      margin-top:12px;
      border-radius:20px;
      background:#fff6f9;
      display:none;
      position:relative;
      overflow:hidden;
    }
    .arena.show{ display:block; }

    .heart{
      position:absolute;
      transform:translate(-50%,-50%);
      cursor:pointer;
      animation: floaty 2.4s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{ transform: translate(-50%,-50%) translateY(0); }
      50%{ transform: translate(-50%,-50%) translateY(-10px); }
    }

    .final{ display:none; margin-top:12px; }
    .final.show{ display:block; }

    .bubble{
      position:fixed;
      max-width:280px;
      padding:10px;
      border-radius:16px;
      background:white;
      border:1px solid #ffd1dc;
      font-size:12px;
      opacity:0;
      pointer-events:none;
      z-index:9998;
      transform:translate(-50%,-100%);
    }
    .bubble.show{ opacity:1; }
  </style>
</head>
<body>

<div class="bubble" id="bubble">mi dispiace non Ã¨ un opzione valida eh eh eh</div>

<main class="wrap">
  <section class="card">

    <div id="screenIntro">
      <div class="photoWrap">
        <img src="stitch.jpg" alt="Stitch">
      </div>

      <h1>Per <span class="name" id="herName">Giorgia</span> ðŸ’˜</h1>
      <p>Raccogli i cuori per sbloccare una domanda segreta ðŸ˜Œ</p>

      <div class="btns">
        <button class="primary" id="startBtn">Inizia ðŸ’ž</button>
        <button class="ghost" id="demoBtn">Demo 5s</button>
      </div>
    </div>

    <div class="arena" id="arena"></div>

    <div class="final" id="final">
      <p><b>Giorgia</b>, vuoi essere il mio <b>San Valentino</b>? ðŸŒ¹</p>
      <div class="btns" id="finalBtns">
        <button class="primary" id="yesBtn">SÃ¬Ã¬Ã¬! ðŸ’–</button>
        <button class="ghost" id="noBtn">No ðŸ˜…</button>
      </div>
      <div id="loveMsg"></div>
    </div>

  </section>
</main>

<script>
const herNick="Stitch";
document.getElementById("herName").textContent=herNick;

const arena=document.getElementById("arena");
const final=document.getElementById("final");
const startBtn=document.getElementById("startBtn");
const demoBtn=document.getElementById("demoBtn");
const heartChars=["ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’•"];

function rand(a,b){return Math.random()*(b-a)+a}

function spawnHeart(){
  const el=document.createElement("div");
  el.className="heart";
  el.textContent=heartChars[Math.floor(Math.random()*heartChars.length)];
  el.style.left=rand(10,90)+"%";
  el.style.top=rand(20,90)+"%";
  el.style.fontSize=rand(26,54)+"px";
  el.addEventListener("pointerdown",()=>el.remove());
  arena.appendChild(el);
}

function startGame(t){
  arena.classList.add("show");
  document.getElementById("screenIntro").style.display="none";
  setTimeout(()=>{ arena.classList.remove("show"); final.classList.add("show"); },t*1000);
  let i=setInterval(spawnHeart,300);
  setTimeout(()=>clearInterval(i),t*1000);
}
startBtn.onclick=()=>startGame(20);
demoBtn.onclick=()=>startGame(5);

const yesBtn=document.getElementById("yesBtn");
const noBtn=document.getElementById("noBtn");
const bubble=document.getElementById("bubble");

yesBtn.onclick=()=>{
  document.getElementById("loveMsg").innerHTML="Allora preparo le candele ðŸ’˜";
  document.getElementById("finalBtns").style.display="none";
};

/* ================= FIX ANDROID ================= */

let suppressClicksUntil=0;
document.addEventListener("click",(e)=>{
  if(Date.now()<suppressClicksUntil){
    e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
  }
},true);

function armSuppress(ms=350){ suppressClicksUntil=Date.now()+ms; }

function showBubble(){
  const r=noBtn.getBoundingClientRect();
  bubble.style.left=(r.left+r.width/2)+"px";
  bubble.style.top=(r.top-10)+"px";
  bubble.classList.add("show");
  setTimeout(()=>bubble.classList.remove("show"),1000);
}

function moveNo(){
  const x=Math.random()*(window.innerWidth-120);
  const y=Math.random()*(window.innerHeight-60);
  noBtn.style.position="fixed";
  noBtn.style.left=x+"px";
  noBtn.style.top=y+"px";
  showBubble();
}

let noCount=0;

noBtn.addEventListener("pointerdown",(e)=>{
  e.preventDefault(); e.stopPropagation();
  try{ noBtn.setPointerCapture(e.pointerId);}catch{}
  noCount++;

  if(noCount<=10){
    armSuppress(400);
    moveNo();
    return;
  }

  noBtn.textContent="Ok okâ€¦ SÃ¬ ðŸ’—";
  noBtn.classList.remove("ghost");
  noBtn.classList.add("primary");
  noBtn.style.position="static";
  armSuppress(400);

  noBtn.addEventListener("click",(ev)=>{
    ev.preventDefault(); ev.stopPropagation();
    yesBtn.click();
  },{once:true});

},{passive:false});
</script>
</body>
</html>
